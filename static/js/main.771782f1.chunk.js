(this["webpackJsonpsea-battle"]=this["webpackJsonpsea-battle"]||[]).push([[0],[,,,,function(e,t,n){},,function(e,t,n){},function(e){e.exports=JSON.parse('{"en":true,"ru":true}')},function(e,t,n){},,function(e,t,n){e.exports=n(21)},,,,,function(e,t,n){},,function(e,t,n){var a={"./allow.json":7,"./en.json":18,"./ru.json":19};function r(e){var t=o(e);return n(t)}function o(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}r.keys=function(){return Object.keys(a)},r.resolve=o,e.exports=r,r.id=17},function(e){e.exports=JSON.parse('{"disabled":"Disabled","enabled":"Enabled","fix_ships":"Fix ships","fix_ships_explain":"You can fix ships if place them wrong","friend_id":"Friend ID","go_battle":"Go battle","good_game":"Good game!","move":"Your move","move_timeout":"The move takes to long...","one_minute_timeout":"We waited for your opponent for a minute...","opponent_hit":"Your opponent is hit to your ship","opponent_move":"Opponent move","player":"Player","please_wait":"Please wait","refresh":"Refresh","server_unavailable":"Server unavailable","ws_closed":"WebSocket is close","your_id":"Your ID"}')},function(e){e.exports=JSON.parse('{"disabled":"\u0412\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u043e","enabled":"\u0412\u043a\u043b\u044e\u0447\u0435\u043d\u043e","fix_ships":"\u041f\u043e\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u043a\u043e\u0440\u0430\u0431\u043b\u0438","fix_ships_explain":"\u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0440\u0430\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0443 \u043a\u043e\u0440\u0430\u0431\u043b\u0435\u0439, \u0435\u0441\u043b\u0438 \u043e\u0448\u0438\u0431\u043b\u0438\u0441\u044c","friend_id":"ID \u0434\u0440\u0443\u0433\u0430","go_battle":"\u0412 \u0431\u043e\u0439","good_game":"\u0423\u0434\u0430\u0447\u043d\u043e\u0439 \u0438\u0433\u0440\u044b!","move":"\u0412\u0430\u0448 \u0445\u043e\u0434","move_timeout":"\u0421\u043b\u0438\u0448\u043a\u043e\u043c \u0434\u043e\u043b\u0433\u043e \u0434\u0435\u043b\u0430\u0435\u0442\u0441\u044f \u0445\u043e\u0434...","one_minute_timeout":"\u0416\u0434\u0430\u043b\u0438 \u0432\u0430\u0448\u0435\u0433\u043e \u0441\u043e\u043f\u0435\u0440\u043d\u0438\u043a\u0430 \u043c\u0438\u043d\u0443\u0442\u0443, \u043d\u0435 \u0434\u043e\u0436\u0434\u0430\u043b\u0438\u0441\u044c...","opponent_hit":"\u0412\u0430\u0448 \u043f\u0440\u043e\u0442\u0438\u0432\u043d\u0438\u043a \u043f\u043e\u043f\u0430\u043b \u0432 \u0432\u0430\u0448 \u043a\u043e\u0440\u0430\u0431\u043b\u044c","opponent_move":"\u0425\u043e\u0434 \u0441\u043e\u043f\u0435\u0440\u043d\u0438\u043a\u0430","player":"\u0418\u0433\u0440\u043e\u043a","please_wait":"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435","refresh":"\u041f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430","server_unavailable":"\u0421\u0435\u0440\u0432\u0435\u0440 \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d","ws_closed":"\u0412\u0435\u0431-\u0441\u043e\u043a\u0435\u0442 \u043a\u0430\u043d\u0430\u043b \u0437\u0430\u043a\u0440\u044b\u0442","your_id":"\u0412\u0430\u0448 ID"}')},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a,r,o=n(0),s=n.n(o),i=n(9),c=n.n(i),u=(n(15),n(1)),l=n.n(u),p=n(3),m=n(2),f=(n(6),function(e){return a[e]}),d=function(){var e=Object(p.a)(l.a.mark((function e(t,n,a,r,o){var s,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/ships",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({opponent:a,ships:t})});case 2:if(!(s=e.sent).ok){e.next=11;break}return e.next=6,s.json();case 6:i=e.sent,n(i.id),"0"!==i.opponentID?(x(!0,"success",f("good_game")),setTimeout((function(){S()}),30),w(i.id),g()):(x(!0,"info",f("please_wait")),v(i.id,r,o)),e.next=13;break;case 11:x(!0,"error",f("server_unavailable")),console.error("Failed, response status: ",s.status);case 13:case"end":return e.stop()}}),e)})));return function(t,n,a,r,o){return e.apply(this,arguments)}}(),v=function(e,t,n){var a=new WebSocket("ws://localhost:4000/ws/opponent/"+e),r=!1;a.onmessage=function(n){var o=n.data,s=JSON.parse(o);"0"!==s.opponentID&&(t(s.opponentID),r=!0,a.close(1e3,"No need more"),x(!0,"success",f("good_game")),setTimeout((function(){x(!0,"success",f("move"))}),1e3),w(e),S(),g())},a.onerror=function(n){b("WebSocket error, id="+e+", downgrade to polling",n),console.error("WebSocket failed: ",n,"downgrade to polling"),h(e,t),r=!0},a.onclose=function(e){!1===r&&(x(!0,"warn",f("one_minute_timeout")),x(!0,"error",f("ws_closed")),console.error("WebSocket closed",e))}},h=function(){var e=Object(p.a)(l.a.mark((function e(t,n){var a,r,o,s,i,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=60,r=0,o="0",s="/opponent?id="+t;case 4:if(!(r<a)){e.next=29;break}return r++,e.next=8,fetch(s,{method:"GET",headers:{"Content-Type":"application/json"}});case 8:if(200!==(i=e.sent).status){e.next=23;break}return e.next=12,i.json();case 12:if(c=e.sent,"0"===(o=c.opponentID)){e.next=19;break}r=a,n(o),e.next=21;break;case 19:return e.next=21,C(1e3);case 21:e.next=27;break;case 23:return r=a,x(!0,"error",f("server_unavailable")),console.log("Failed to polling, response status: ",i.status),e.abrupt("return");case 27:e.next=4;break;case 29:"0"!==o?(x(!0,"success",f("good_game")),setTimeout((function(){x(!0,"success",f("move"))}),1e3),w(t),g()):x(!0,"warn",f("one_minute_timeout"));case 30:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),b=function(){var e=Object(p.a)(l.a.mark((function e(t){var n,a,r,o=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:"",a={message:t,error:{message:n.message,arguments:n.arguments,type:n.type,name:n.name}},r="/log",e.next=5,fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){window.scrollTo({top:0,behavior:"smooth"})},y=function(){var e=Object(p.a)(l.a.mark((function e(t,n,a,r){var o,s,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="/shot?id="+t+"&x="+n+"&y="+a,e.next=3,fetch(o,{method:"GET",headers:{"Content-Type":"application/json"}});case 3:if(202!==(s=e.sent).status){e.next=9;break}x(!0,"info",f("please_wait")),console.info("Failed, response status: ",s.status),e.next=20;break;case 9:if(!s.ok){e.next=18;break}return e.next=12,s.json();case 12:return i=e.sent,e.next=15,r(i);case 15:x(!1),e.next=20;break;case 18:x(!0,"error",f("server_unavailable")),console.error("Failed, response status: ",s.status);case 20:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),w=function(){var e=Object(p.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=new WebSocket("ws://localhost:4000/ws/moves/"+t)).onopen=function(){n.send(JSON.stringify({id:t}))},n.onmessage=function(e){var t=e.data,n=JSON.parse(t).action;"move"!==n&&"opponent_hit"!==n&&"opponent_move"!==n||(x(!1),setTimeout((function(){x(!0,"success",f(n))}),50))},n.onerror=function(e){b("WebSocket error, id="+t+", downgrade to polling",e),console.error("WebSocket failed: ",e,"downgrade to polling"),E(t)},n.onclose=function(e){x(!0,"warn",f("move_timeout"))};case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=Object(p.a)(l.a.mark((function e(t){var n,a,r,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=10,a=0,r="/move?id="+t;case 3:if(!(a<n)){e.next=17;break}return a++,e.next=7,fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});case 7:if(200!==(o=e.sent).status){e.next=15;break}return e.next=11,o.json();case 11:return!0===e.sent.can&&(x(!0,"success",f("move")),a=0),e.next=15,C(1e3);case 15:e.next=3;break;case 17:a>=n&&x(!0,"warn",f("move_timeout"));case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),x=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=document.getElementById("popup");null!==a&&(a.classList.remove("success","error","info","warn"),!0===e?(a.classList.add("show"),a.classList.add(t)):a.classList.remove("show"),a.innerHTML=n+"<span>\xd7</span>")},O=function(){for(var e=[],t=0;t<10;t++){for(var n=[],a=0;a<10;a++)n.push(0);e.push(n)}return e},k=function(e){if(1===e)return{display:"none"}};!function(e){e[e.none=0]="none",e[e.hit=1]="hit",e[e.miss=2]="miss"}(r||(r={}));var _,j=function(){var e=Object(p.a)(l.a.mark((function e(t,n,a,o){var s,i,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=function(){return(c=Object(p.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=t.type;case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)},i=function(e){return c.apply(this,arguments)},s="none",e.next=5,y(t,n,a,i);case 5:s===r[r.miss]?o(n,a,1):s===r[r.hit]&&o(n,a,2);case 6:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),S=function(){var e=document.getElementById("yID");null!==e&&(e.style.display="none")},C=function(e){return new Promise((function(t){return setTimeout(t,e)}))},N=function(e){e.setMode;var t=e.gameMode,n=e.goBattle,a=e.setClear,r=e.isClear,i=e.setOpponentID,c=e.ID,u=e.copyOpID,l=Object(o.useState)(""),p=Object(m.a)(l,2),d=p[0],v=p[1];return s.a.createElement("div",{className:"Buttons"},s.a.createElement("form",{onSubmit:function(e){n(),e.preventDefault()},style:k(t)},s.a.createElement("label",null,f("friend_id"),": ",s.a.createElement("input",{type:"number",value:d,placeholder:"0",onChange:function(e){var t=e.target.value;t>0&&(v(t),i(t))}})),s.a.createElement("input",{type:"submit",value:f("go_battle")})),s.a.createElement("button",{onClick:function(){return a(!r)},style:k(t)},f("fix_ships")),s.a.createElement("i",{style:k(t)},f(!0===r?"enabled":"disabled")),s.a.createElement("p",{style:k(t)},f("fix_ships_explain")),s.a.createElement("span",{style:k((t+1)%2),id:"yID",onClick:function(){u()}},f("your_id"),": ",c))},D=(n(8),function(e){var t=e.count,n=e.name;return s.a.createElement("div",{className:"CounterTab"},s.a.createElement("p",null,t),s.a.createElement("p",null,n))}),I=function(e){var t=e.player1,n=e.player2;return s.a.createElement("div",{className:"Scoreboard"},s.a.createElement(D,{count:t,name:f("player")+" 1"}),s.a.createElement(D,{count:n,name:f("player")+" 2"}))},T=(n(4),function(e){var t;return t="assets/"+(t=!0===e.isKill?"Hit":"Miss")+"Small.png",s.a.createElement("div",{className:"Indicator"},s.a.createElement("img",{src:t,alt:""}))}),M=function(e){var t=e.i,n=e.name,a=e.count,r=e.kill,i=e.changeKill,c="assets/"+n+"Shape.png",u=Object(o.useState)(d()),l=Object(m.a)(u,2),p=l[0],f=l[1];function d(){for(var e=[],t=0;t<r;t++)e.push(s.a.createElement(T,{isKill:!0}));for(var n=r;n<a;n++)e.push(s.a.createElement(T,{isKill:!1}));return e}return Object(o.useEffect)((function(){f(d())}),[r]),s.a.createElement("div",{className:"Ship"},s.a.createElement("img",{src:c,alt:n}),s.a.createElement("p",null,a),p,s.a.createElement("button",{onClick:function(){i(t,1)}},"+"),s.a.createElement("p",null,r))};!function(e){e[e.Cruiser=0]="Cruiser",e[e.Battleship=1]="Battleship",e[e.Destroyer=2]="Destroyer",e[e.Boat=3]="Boat"}(_||(_={}));var B=function(){var e=Object(o.useState)([0,0,0,0]),t=Object(m.a)(e,2),n=t[0],a=t[1];function r(e,t){var r=n;r[e]=(r[e]+1)%(e+2),a(r)}return s.a.createElement("div",{className:"Shipsboard"},function(){for(var e=[],t=0;t<4;t++)e.push(s.a.createElement(M,{key:[t,n[t]].toString(),i:t,name:_[t],count:t+1,kill:n[t],changeKill:r}));return e}())},W=function(e){if(1===e)return{cursor:"url('assets/aim50.png') 25 25, auto"}},J=s.a.memo((function(e){var t=e.i,n=e.isClear,a=e.element,r=e.gameMode,i=e.setCell,c=e.shot;function u(e){var o;return 0===r?!1===e?(o=function(e,t){return!1===e&&!1===t?"Ship":"Empty"}(e,n),i(t)):!0===n?(o="Empty",1===a&&(o="Ship")):o="Empty":1===r&&(!1===e?0===a?(c(t),o="Empty"):1===a?o="Miss":2===a&&(o="Hit"):o=0===a?"Empty":1===a?"Miss":"Hit"),o="assets/"+o+".png",s.a.createElement("img",{src:o,alt:"",width:"100%",height:"100%"})}Object(o.useEffect)((function(){d(u(!0))}),[a]);var l=Object(o.useState)(u(!0)),p=Object(m.a)(l,2),f=p[0],d=p[1];return s.a.createElement("div",{className:"Cell",onClick:function(){return d(u(!1))},style:W(r)},f)})),F=s.a.memo((function(e){var t=e.i,n=e.isClear,a=e.gameMode,r=e.row,i=e.shot,c=Object(o.useState)(r);function u(e){i(t,e)}function l(e){r[e]=!1===n?1:0}r=c[0];var p=function(){for(var e=[],t=0;t<10;t++)e.push(s.a.createElement(J,{i:t,isClear:n,gameMode:a,setCell:l,shot:u,element:r[t]}));return e}();return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"CellRow"},p))})),L=(n(20),function(e){var t=e.isClear,n=e.gameMode,a=e.field,r=e.shot;var o=function(){for(var e=[],o=0;o<10;o++)e.push(s.a.createElement(F,{i:o,isClear:t,gameMode:n,row:a[o],shot:r}));return e}();return s.a.createElement("div",{className:"Battlefield"},o)}),G=function(){!function(e){!0!==n(7)[e=e||navigator.language]&&(e="en"),a=n(17)("./"+e+".json");var t=document.getElementById("html");null!==t&&t.setAttribute("lang",e)}();var e=Object(o.useState)(0),t=Object(m.a)(e,2),r=t[0],i=(t[1],Object(o.useState)(0)),c=Object(m.a)(i,2),u=c[0],f=(c[1],Object(o.useState)(0)),v=Object(m.a)(f,2),h=v[0],b=v[1],g=Object(o.useState)(O()),y=Object(m.a)(g,2),w=y[0],E=y[1],k=Object(o.useState)(!1),_=Object(m.a)(k,2),S=_[0],C=_[1],D=Object(o.useState)("0"),T=Object(m.a)(D,2),M=T[0],W=T[1],J=Object(o.useState)("0"),F=Object(m.a)(J,2),G=F[0],K=F[1],P=Object(o.useState)("light"),H=Object(m.a)(P,2),Y=H[0],A=H[1];function R(e,t,n){var a=w;a[e][t]=n,E(a)}Object(o.useEffect)((function(){var e=document.getElementById("html");null!==e&&("light"===Y?e.classList.remove("dark-mode"):"dark"===Y&&e.classList.add("dark-mode"))}),[Y]);var U=function(){var e=Object(p.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d(w,K,M,W,b);case 2:E(O()),b(1),C(!1);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$=Object(o.useState)(0),q=Object(m.a)($,2),z=q[0],Q=q[1];function V(){return(V=Object(p.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(G,t,n,R);case 2:Q((z+1)%2);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return s.a.createElement("div",{className:"App"},s.a.createElement("div",{className:"theme-toggle",onClick:function(){"light"===Y?A("dark"):"dark"===Y&&A("light")}},"\ud83c\udf13"),s.a.createElement("div",{className:"inline-board"},s.a.createElement(I,{player1:r,player2:u}),s.a.createElement(B,null),s.a.createElement(N,{gameMode:h,setMode:b,goBattle:U,isClear:S,setClear:C,setOpponentID:W,ID:G,copyOpID:function(){navigator.clipboard.writeText(G)}})),s.a.createElement("div",{className:"inline-field"},s.a.createElement(L,{key:h.toString(),isClear:S,gameMode:h,field:w,shot:function(e,t){return V.apply(this,arguments)}})),s.a.createElement("div",{className:"popup"},s.a.createElement("div",{className:"popup-box",id:"popup",onClick:function(){return x(!1)}})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(G,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[10,1,2]]]);
//# sourceMappingURL=main.771782f1.chunk.js.map