(this["webpackJsonpsea-battle"]=this["webpackJsonpsea-battle"]||[]).push([[0],[,,,,,,,,function(e){e.exports=JSON.parse('{"en":true,"ru":true}')},,function(e,t,n){e.exports=n(23)},,,,,function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){var r={"./allow.json":8,"./en.json":20,"./ru.json":21};function a(e){var t=o(e);return n(t)}function o(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=o,e.exports=a,a.id=19},function(e){e.exports=JSON.parse('{"copied":"Copied!","decrease_alive":"Your opponent kill one your ship","disabled":"Disabled","enabled":"Enabled","fix_ships":"Fix ships","fix_ships_explain":"You can fix ships if place them wrong","friend_id":"Friend ID","go_battle":"Go battle","good_game":"Good game!","incorrect_ship_placement":"Ship placement is incorrect","move":"Your move","move_timeout":"The move takes to long...","new_game":"New game","one_minute_timeout":"We waited for your opponent for a minute...","opponent_hit":"Your opponent is hit to your ship","opponent_move":"Opponent move","please_wait":"Please wait","sea_battle_title":"Sea battle","server_unavailable":"Server unavailable","space":"Press SPACE","ws_closed":"WebSocket is close","your_id":"Your ID"}')},function(e){e.exports=JSON.parse('{"copied":"\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e!","decrease_alive":"\u0412\u0430\u0448 \u0441\u043e\u043f\u0435\u0440\u043d\u0438\u043a \u0443\u0431\u0438\u043b \u043e\u0434\u0438\u043d \u0432\u0430\u0448 \u043a\u043e\u0440\u0430\u0431\u043b\u044c","disabled":"\u0412\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u043e","enabled":"\u0412\u043a\u043b\u044e\u0447\u0435\u043d\u043e","fix_ships":"\u041f\u043e\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u043a\u043e\u0440\u0430\u0431\u043b\u0438","fix_ships_explain":"\u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0440\u0430\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0443 \u043a\u043e\u0440\u0430\u0431\u043b\u0435\u0439, \u0435\u0441\u043b\u0438 \u043e\u0448\u0438\u0431\u043b\u0438\u0441\u044c","friend_id":"ID \u0434\u0440\u0443\u0433\u0430","go_battle":"\u0412 \u0431\u043e\u0439","good_game":"\u0423\u0434\u0430\u0447\u043d\u043e\u0439 \u0438\u0433\u0440\u044b!","incorrect_ship_placement":"\u041a\u043e\u0440\u0430\u0431\u043b\u0438 \u0440\u0430\u0441\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u044b \u043d\u0435\u0432\u0435\u0440\u043d\u043e","move":"\u0412\u0430\u0448 \u0445\u043e\u0434","move_timeout":"\u0421\u043b\u0438\u0448\u043a\u043e\u043c \u0434\u043e\u043b\u0433\u043e \u0434\u0435\u043b\u0430\u0435\u0442\u0441\u044f \u0445\u043e\u0434...","new_game":"\u041d\u043e\u0432\u0430\u044f \u0438\u0433\u0440\u0430","one_minute_timeout":"\u0416\u0434\u0430\u043b\u0438 \u0432\u0430\u0448\u0435\u0433\u043e \u0441\u043e\u043f\u0435\u0440\u043d\u0438\u043a\u0430 \u043c\u0438\u043d\u0443\u0442\u0443, \u043d\u0435 \u0434\u043e\u0436\u0434\u0430\u043b\u0438\u0441\u044c...","opponent_hit":"\u0412\u0430\u0448 \u043f\u0440\u043e\u0442\u0438\u0432\u043d\u0438\u043a \u043f\u043e\u043f\u0430\u043b \u0432 \u0432\u0430\u0448 \u043a\u043e\u0440\u0430\u0431\u043b\u044c","opponent_move":"\u0425\u043e\u0434 \u0441\u043e\u043f\u0435\u0440\u043d\u0438\u043a\u0430","please_wait":"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435","sea_battle_title":"\u041c\u043e\u0440\u0441\u043a\u043e\u0439 \u0431\u043e\u0439","server_unavailable":"\u0421\u0435\u0440\u0432\u0435\u0440 \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d","space":"\u041d\u0430\u0436\u043c\u0438 \u041f\u0420\u041e\u0411\u0415\u041b","ws_closed":"\u0412\u0435\u0431-\u0441\u043e\u043a\u0435\u0442 \u043a\u0430\u043d\u0430\u043b \u0437\u0430\u043a\u0440\u044b\u0442","your_id":"\u0412\u0430\u0448 ID"}')},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r,a,o=n(0),s=n.n(o),i=n(9),c=n.n(i),u=(n(15),n(1)),l=n.n(u),p=n(2),f=n(3),d=(n(17),n(18),n(6)),m=function(e){return r[e]},v=function(){var e=Object(p.a)(l.a.mark((function e(t,n,r,a,o){var s,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/ships",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({opponent:r,field:t.field,total:t.total,len:t.len})});case 2:if(!(s=e.sent).ok){e.next=11;break}return e.next=6,s.json();case 6:i=e.sent,n(i.id),"0"!==i.opponentID?(k(!0,"success",m("good_game")),setTimeout((function(){S()}),30),y(i.id),w()):(k(!0,"info",m("please_wait")),h(i.id,a,o)),e.next=13;break;case 11:k(!0,"error",m("server_unavailable")),console.error("Failed, response status: ",s.status);case 13:case"end":return e.stop()}}),e)})));return function(t,n,r,a,o){return e.apply(this,arguments)}}(),h=function(e,t,n){var r=new WebSocket("ws://localhost:4000/ws/opponent/"+e),a=!1;r.onmessage=function(n){var o=n.data,s=JSON.parse(o);"0"!==s.opponentID&&(t(s.opponentID),a=!0,r.close(1e3,"No need more"),k(!0,"success",m("good_game")),setTimeout((function(){k(!0,"success",m("move"))}),1e3),y(e),S(),w())},r.onerror=function(n){g("WebSocket error, id="+e+", downgrade to polling",n),console.error("WebSocket failed: ",n,"downgrade to polling"),b(e,t),a=!0},r.onclose=function(e){!1===a&&(k(!0,"warn",m("one_minute_timeout")),console.error("WebSocket closed",e))}},b=function(){var e=Object(p.a)(l.a.mark((function e(t,n){var r,a,o,s,i,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=60,a=0,o="0",s="/opponent?id="+t;case 4:if(!(a<r)){e.next=29;break}return a++,e.next=8,fetch(s,{method:"GET",headers:{"Content-Type":"application/json"}});case 8:if(200!==(i=e.sent).status){e.next=23;break}return e.next=12,i.json();case 12:if(c=e.sent,"0"===(o=c.opponentID)){e.next=19;break}a=r,n(o),e.next=21;break;case 19:return e.next=21,C(1e3);case 21:e.next=27;break;case 23:return a=r,k(!0,"error",m("server_unavailable")),console.log("Failed to polling, response status: ",i.status),e.abrupt("return");case 27:e.next=4;break;case 29:"0"!==o?(k(!0,"success",m("good_game")),setTimeout((function(){k(!0,"success",m("move"))}),1e3),y(t),w()):k(!0,"warn",m("one_minute_timeout"));case 30:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),g=function(){var e=Object(p.a)(l.a.mark((function e(t){var n,r,a,o=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:"",r={message:t,error:{message:n.message,arguments:n.arguments,type:n.type,name:n.name}},a="/log",e.next=5,fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(){window.scrollTo({top:0,behavior:"smooth"})},_=function(){var e=Object(p.a)(l.a.mark((function e(t,n,r,a){var o,s,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="/shot?id="+t+"&x="+n+"&y="+r,e.next=3,fetch(o,{method:"GET",headers:{"Content-Type":"application/json"}});case 3:if(202!==(s=e.sent).status){e.next=9;break}k(!0,"info",m("please_wait")),console.info("Failed, response status: ",s.status),e.next=20;break;case 9:if(!s.ok){e.next=18;break}return e.next=12,s.json();case 12:return i=e.sent,e.next=15,a(i);case 15:k(!1),e.next=20;break;case 18:k(!0,"error",m("server_unavailable")),console.error("Failed, response status: ",s.status);case 20:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),y=function(){var e=Object(p.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=new WebSocket("ws://localhost:4000/ws/battle/"+t)).onopen=function(){n.send(JSON.stringify({id:t}))},n.onmessage=function(e){var t=e.data,n=(t=JSON.parse(t)).action;"move"!==n&&"opponent_hit"!==n&&"opponent_move"!==n&&"decrease_alive"!==n||(k(!1),setTimeout((function(){k(!0,"success",m(n))}),50))},n.onerror=function(e){g("WebSocket error, id="+t+", downgrade to polling",e),console.error("WebSocket failed: ",e,"downgrade to polling"),x(t)},n.onclose=function(e){k(!0,"warn",m("move_timeout"))};case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),x=function(){var e=Object(p.a)(l.a.mark((function e(t){var n,r,a,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=10,r=0,a="/move?id="+t;case 3:if(!(r<n)){e.next=17;break}return r++,e.next=7,fetch(a,{method:"GET",headers:{"Content-Type":"application/json"}});case 7:if(200!==(o=e.sent).status){e.next=15;break}return e.next=11,o.json();case 11:return!0===e.sent.can&&(k(!0,"success",m("move")),r=0),e.next=15,C(1e3);case 15:e.next=3;break;case 17:r>=n&&k(!0,"warn",m("move_timeout"));case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=document.getElementById("popup");null!==r&&(r.classList.remove("success","error","info","warn"),!0===e?(r.classList.add("show"),r.classList.add(t)):r.classList.remove("show"),r.innerHTML=n+"<span>\xd7</span>")},O=function(){for(var e=[],t=0;t<10;t++){for(var n=[],r=0;r<10;r++)n.push(0);e.push(n)}return e},E=function(e){if(1===e)return{display:"none"}};!function(e){e[e.none=0]="none",e[e.hit=1]="hit",e[e.miss=2]="miss"}(a||(a={}));var j=function(){var e=Object(p.a)(l.a.mark((function e(t,n,r,o){var s,i,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=function(){return(c=Object(p.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=t.type;case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)},i=function(e){return c.apply(this,arguments)},s="none",e.next=5,_(t,n,r,i);case 5:s===a[a.miss]?o(n,r,1):s===a[a.hit]&&o(n,r,2);case 6:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),S=function(){var e=document.getElementById("yID");null!==e&&(e.style.display="none")},C=function(e){return new Promise((function(t){return setTimeout(t,e)}))},N=function(e){var t,n,r=[];for(t=0;t<10;t++){var a=[];for(n=0;n<10;n++)0!==e[t][n]?a.push(3):a.push(0);r.push(a)}return r},D=function(e){var t,n,r,a=Object(d.a)(e),o={},s={result:"fail",field:a,total:0,len:{}},i=1;for(t=0;t<10;t++)for(n=0;n<10;n++)if(1===e[t][n]){if("fail"===(r=I(e,t,n)).res)return s;"success"===r.res&&(a=T(a,r,i),o[i]=r.len,i++)}return s.result="success",s.field=a,s.total=i-1,s.len=o,s},I=function(e,t,n){var r={res:"none",type:"none",index:-1,beg:-1,end:-1,len:-1};if(0!==t&&1===e[t-1][n])return r.res="finded",r;if(0!==n&&1===e[t][n-1])return r.res="finded",r;var a=t,o=t,s=function(t,n,r,a,o){return(0!==t||1!==e[n+a][r+o])&&((9!==t||1!==e[n-a][r-o])&&(!(t>0&&t<9)||1!==e[n-a][r-o]&&1!==e[n+a][r+o]))};if(t<9&&1===e[t+1][n])for(;o<10;){if(!1===s(n,o,n,0,1))return r.res="fail",r;if(9===o||0===e[o+1][n])return 9!==o&&!1===s(n,o+1,n,0,1)?(r.res="fail",r):r={res:"success",type:"col",index:n,beg:a,end:o,len:o-a+1};o++}else{if(!(n<9&&1===e[t][n+1]))return n<9&&!1===s(t,t,n+1,1,0)?(r.res="fail",r):r={res:"success",type:"row",index:t,beg:n,end:n,len:1};for(a=o=n;o<10;){if(!1===s(t,t,o,1,0))return r.res="fail",r;if(9===o||0===e[t][o+1])return 9!==o&&!1===s(t,t,o+1,1,0)?(r.res="fail",r):r={res:"success",type:"row",index:t,beg:a,end:o,len:o-a+1};o++}}return r},T=function(e,t,n){var r,a=Object(d.a)(e);for(r=t.beg;r<=t.end;r++)"row"===t.type?a[t.index][r]=n:"col"===t.type&&(a[r][t.index]=n);return a},M=function(e){var t=e.gameMode,n=e.goBattle,r=e.setClear,a=e.isClear,i=e.setOpponentID,c=e.ID,u=e.copyOpID,l=Object(o.useState)(""),p=Object(f.a)(l,2),d=p[0],v=p[1];return s.a.createElement("div",{className:"Buttons"},s.a.createElement("div",{style:E(t)},s.a.createElement("form",{onSubmit:function(e){n(),e.preventDefault()}},s.a.createElement("label",null,m("friend_id"),": ",s.a.createElement("input",{type:"number",value:d,placeholder:"0",onChange:function(e){var t=e.target.value;t>0&&(v(t),i(t))}})),s.a.createElement("input",{type:"submit",value:m("go_battle")})),s.a.createElement("code",null,m("space")),s.a.createElement("button",{onClick:function(){return r(!a)}},m("fix_ships")),s.a.createElement("i",null,m(!0===a?"enabled":"disabled")),s.a.createElement("p",null,m("fix_ships_explain"))),s.a.createElement("div",{style:E((t+1)%2)},s.a.createElement("span",{id:"yID",onClick:function(){u()}},m("your_id"),": ",c),s.a.createElement("br",null)))},W=function(e){if(1===e)return{cursor:"url('assets/aim50.png') 25 25, auto"}},B=s.a.memo((function(e){var t=e.i,n=e.isClear,r=e.element,a=e.gameMode,i=e.setCell,c=e.shot,u=Object(o.useState)("Empty"),l=Object(f.a)(u,2),p=l[0],d=l[1];return Object(o.useEffect)((function(){var e;1===a?d(1===(e=r)?"Miss":2===e?"Hit":"Empty"):2===a&&d(function(e){return 0===e?"Empty":1===e?"Miss":2===e?"Hit":3===e?"Ship":""}(r))}),[r]),s.a.createElement("div",{className:"Cell",onClick:function(){0===a?(d(!1===n?"Ship":"Empty"),i(t)):1===a&&0===r&&c(t)},style:W(a)},s.a.createElement("img",{src:"assets/"+p+".png",alt:"",width:"100%",height:"100%"}))})),J=s.a.memo((function(e){var t=e.i,n=e.isClear,r=e.gameMode,a=e.row,i=e.shot,c=Object(o.useState)(a);function u(e){i(t,e)}function l(e){a[e]=!1===n?1:0}a=c[0];var p=function(){for(var e=[],t=0;t<10;t++)e.push(s.a.createElement(B,{i:t,isClear:n,gameMode:r,setCell:l,shot:u,element:a[t]}));return e}();return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"CellRow"},p))})),L=(n(22),function(e){var t=e.isClear,n=e.gameMode,r=e.field,a=e.shot;var o=function(){for(var e=[],o=0;o<10;o++)e.push(s.a.createElement(J,{i:o,isClear:t,gameMode:n,row:r[o],shot:a}));return e}();return s.a.createElement("div",{className:"Battlefield"},o)});var F=function(){!function(e){!0!==n(8)[e=e||navigator.language]&&(e="en"),r=n(19)("./"+e+".json");var t=document.getElementById("html");null!==t&&t.setAttribute("lang",e)}();var e,t,a=Object(o.useState)(0),i=Object(f.a)(a,2),c=i[0],u=i[1],d=Object(o.useState)(O()),h=Object(f.a)(d,2),b=h[0],g=h[1],w=Object(o.useState)(O()),_=Object(f.a)(w,2),y=_[0],x=_[1],S=Object(o.useState)(!1),C=Object(f.a)(S,2),I=C[0],T=C[1];e=" ",t=function(){return T((function(e){return!e}))},Object(o.useEffect)((function(){function n(n){n.key===e&&(n.preventDefault(),t())}return window.addEventListener("keyup",n),function(){return window.removeEventListener("keyup",n)}}),[]);var W=Object(o.useState)("0"),B=Object(f.a)(W,2),J=B[0],F=B[1],P=Object(o.useState)("0"),G=Object(f.a)(P,2),Y=G[0],H=G[1];var A=Object(o.useState)(function(){var e=(new Date).getHours();return e>6&&e<18?"light":"dark"}()),U=Object(f.a)(A,2),R=U[0],$=U[1];function q(e,t,n){var r=y;r[e][t]=n,x(r)}Object(o.useEffect)((function(){var e=document.getElementById("html");null!==e&&("light"===R?e.classList.remove("dark-mode"):"dark"===R&&e.classList.add("dark-mode"))}),[R]);var z=function(){var e=Object(p.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("fail"!==(t=D(y)).result){e.next=4;break}return k(!0,"warn",m("incorrect_ship_placement")),e.abrupt("return");case 4:return e.next=6,v(t,H,J,F,u);case 6:g(N(y)),x(O()),u(1),T(!1);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=Object(o.useState)(0),Q=Object(f.a)(K,2),V=Q[0],X=Q[1];function Z(e,t){return ee.apply(this,arguments)}function ee(){return(ee=Object(p.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(Y,t,n,q);case 2:X((V+1)%2);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return s.a.createElement("div",{className:"App"},s.a.createElement("span",{role:"img","aria-label":"toggler",className:"theme-toggle",onClick:function(){"light"===R?$("dark"):"dark"===R&&$("light")}},"\ud83c\udf13"),s.a.createElement("div",{className:"inline-board"},s.a.createElement("h1",{className:"title",style:E(c)},m("sea_battle_title")),s.a.createElement("div",{style:E((c+1)%2)},s.a.createElement(L,{key:c.toString(),isClear:I,gameMode:2,field:b,shot:Z})),s.a.createElement(M,{gameMode:c,goBattle:z,isClear:I,setClear:T,setOpponentID:F,ID:Y,copyOpID:function(){navigator.clipboard.writeText(Y),k(!0,"success",m("copied"))}})),s.a.createElement("div",{className:"inline-field"},s.a.createElement(L,{key:c.toString(),isClear:I,gameMode:c,field:y,shot:Z})),s.a.createElement("div",{className:"popup"},s.a.createElement("div",{className:"popup-box",id:"popup",onClick:function(){return k(!1)}})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(F,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[10,1,2]]]);
//# sourceMappingURL=main.fc2dec2f.chunk.js.map